<RegisterScreen>:
    canvas.before:
        Color:
            rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        
        # Header
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(70)
            padding: [dp(15), dp(10)]
            spacing: dp(10)
            
            canvas.before:
                Color:
                    rgba: 204/255, 197/255, 185/255, 1  # #CCC5B9
                Rectangle:
                    pos: self.pos
                    size: self.size
                Color:
                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                Line:
                    width: dp(1)
                    rectangle: (self.x, self.y, self.width, self.height)
            
            Button:
                text: "Volver"
                size_hint: None, None
                size: dp(70), dp(40)
                background_color: 0, 0, 0, 0
                color: 20/255, 26/255, 28/255, 1
                font_size: sp(12)
                bold: True
                on_press: root.go_back()
                canvas.before:
                    Color:
                        rgba: 168/255, 159/255, 145/255, 1  # #A89F91
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8)]
                    Color:
                        rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                    Line:
                        width: dp(1)
                        rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
            
            Label:
                text: "Registro de Cuenta"
                color: 20/255, 26/255, 28/255, 1
                font_size: sp(20)
                bold: True
                text_size: self.size
                halign: 'center'
                valign: 'middle'
        
        # Área Descripción
        BoxLayout:
            size_hint_y: None
            height: dp(60)
            padding: [dp(20), dp(15)]
            
            canvas.before:
                Color:
                    rgba: 204/255, 197/255, 185/255, 1  # #CCC5B9
                Rectangle:
                    pos: self.pos
                    size: self.size
                Color:
                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                Line:
                    width: dp(1)
                    points: [self.x, self.y, self.x + self.width, self.y]
            
            Label:
                text: "Tipo de cuenta: " + root.account_type.title()
                color: 20/255, 26/255, 28/255, 1
                font_size: sp(16)
                text_size: self.size
                halign: 'center'
                valign: 'middle'
        
        # Contenido Principal
        BoxLayout:
            orientation: 'vertical'
            padding: [dp(15), dp(10)]
            
            ScrollView:
                canvas.before:
                    Color:
                        rgba: 204/255, 197/255, 185/255, 1  # #CCC5B9
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(12)]
                    Color:
                        rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                    Line:
                        width: dp(1)
                        rounded_rectangle: (self.x, self.y, self.width, self.height, dp(12))
                
                do_scroll_x: False
                do_scroll_y: True
                
                BoxLayout:
                    orientation: "vertical"
                    padding: [dp(20), dp(15)]
                    spacing: dp(12)
                    size_hint_y: None
                    height: self.minimum_height
                    
                    # CAMPOS PARA COMPANY
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type == "company" else dp(0)
                        opacity: 1 if root.account_type == "company" else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Nombre de la Empresa"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        TextInput:
                            id: company_name_input
                            hint_text: "Ingresa el nombre de tu empresa"
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            foreground_color: 20/255, 26/255, 28/255, 1
                            cursor_color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)
                            padding: [dp(15), dp(12)]
                            multiline: False
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                                    
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type == "company" else dp(0)
                        opacity: 1 if root.account_type == "company" else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Email de la Empresa"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        TextInput:
                            id: company_email_input
                            hint_text: "empresa@ejemplo.com"
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            foreground_color: 20/255, 26/255, 28/255, 1
                            cursor_color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)
                            padding: [dp(15), dp(12)]
                            multiline: False
                            input_filter: None
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                                    
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type == "company" else dp(0)
                        opacity: 1 if root.account_type == "company" else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Contraseña"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        TextInput:
                            id: company_password_input
                            hint_text: "Mínimo 6 caracteres"
                            password: True
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            foreground_color: 20/255, 26/255, 28/255, 1
                            cursor_color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)
                            padding: [dp(15), dp(12)]
                            multiline: False
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                                    
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type == "company" else dp(0)
                        opacity: 1 if root.account_type == "company" else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Confirmar Contraseña"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        TextInput:
                            id: company_password_confirm_input
                            hint_text: "Confirma tu contraseña"
                            password: True
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            foreground_color: 20/255, 26/255, 28/255, 1
                            cursor_color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)
                            padding: [dp(15), dp(12)]
                            multiline: False
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                    
                    # CAMPOS PARA DRIVER
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type == "driver" else dp(0)
                        opacity: 1 if root.account_type == "driver" else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Nombre del Conductor"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        TextInput:
                            id: driver_name_input
                            hint_text: "Ingresa tu nombre completo"
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            foreground_color: 20/255, 26/255, 28/255, 1
                            cursor_color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)
                            padding: [dp(15), dp(12)]
                            multiline: False
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                                    
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type == "driver" else dp(0)
                        opacity: 1 if root.account_type == "driver" else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Email del Conductor"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        TextInput:
                            id: driver_email_input
                            hint_text: "conductor@ejemplo.com"
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            foreground_color: 20/255, 26/255, 28/255, 1
                            cursor_color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)
                            padding: [dp(15), dp(12)]
                            multiline: False
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                                    
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type == "driver" else dp(0)
                        opacity: 1 if root.account_type == "driver" else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Contraseña"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        TextInput:
                            id: driver_password_input
                            hint_text: "Mínimo 6 caracteres"
                            password: True
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            foreground_color: 20/255, 26/255, 28/255, 1
                            cursor_color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)
                            padding: [dp(15), dp(12)]
                            multiline: False
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                                    
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type == "driver" else dp(0)
                        opacity: 1 if root.account_type == "driver" else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Confirmar Contraseña"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        TextInput:
                            id: driver_password_confirm_input
                            hint_text: "Confirma tu contraseña"
                            password: True
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            foreground_color: 20/255, 26/255, 28/255, 1
                            cursor_color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)
                            padding: [dp(15), dp(12)]
                            multiline: False
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                    
                    # CAMPOS PARA ADMIN
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type == "admin" else dp(0)
                        opacity: 1 if root.account_type == "admin" else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Nombre del Administrador"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        TextInput:
                            id: admin_name_input
                            hint_text: "Ingresa tu nombre completo"
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            foreground_color: 20/255, 26/255, 28/255, 1
                            cursor_color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)
                            padding: [dp(15), dp(12)]
                            multiline: False
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                                    
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type == "admin" else dp(0)
                        opacity: 1 if root.account_type == "admin" else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Email del Administrador"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        TextInput:
                            id: admin_email_input
                            hint_text: "admin@ejemplo.com"
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            foreground_color: 20/255, 26/255, 28/255, 1
                            cursor_color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)
                            padding: [dp(15), dp(12)]
                            multiline: False
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                                    
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type == "admin" else dp(0)
                        opacity: 1 if root.account_type == "admin" else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Contraseña"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        TextInput:
                            id: admin_password_input
                            hint_text: "Mínimo 6 caracteres"
                            password: True
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            foreground_color: 20/255, 26/255, 28/255, 1
                            cursor_color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)
                            padding: [dp(15), dp(12)]
                            multiline: False
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                                    
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type == "admin" else dp(0)
                        opacity: 1 if root.account_type == "admin" else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Confirmar Contraseña"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        TextInput:
                            id: admin_password_confirm_input
                            hint_text: "Confirma tu contraseña"
                            password: True
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            foreground_color: 20/255, 26/255, 28/255, 1
                            cursor_color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)
                            padding: [dp(15), dp(12)]
                            multiline: False
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                    
                    # Spinner para seleccionar empresa (solo para driver y admin)
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(90) if root.account_type in ["driver", "admin"] else dp(0)
                        opacity: 1 if root.account_type in ["driver", "admin"] else 0
                        spacing: dp(8)
                        
                        Label:
                            text: "Seleccionar Empresa"
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(14)
                            bold: True
                            size_hint_y: None
                            height: dp(25)
                            text_size: self.size
                            halign: "left"
                            valign: "middle"
                        
                        Spinner:
                            id: company_spinner
                            text: "Selecciona una empresa"
                            values: root.get_company_list()
                            size_hint_y: None
                            height: dp(50)
                            background_color: 0, 0, 0, 0
                            background_normal: ''
                            color: 20/255, 26/255, 28/255, 1
                            font_size: sp(16)  
                            on_text: root.on_company_selected(self.text)
                            canvas.before:
                                Color:
                                    rgba: 255/255, 252/255, 242/255, 1  # #FFFCF2
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8)]
                                Color:
                                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                                Line:
                                    width: dp(1)
                                    rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))
                    
                    # Indicador de estado de contraseñas
                    Label:
                        id: password_status_label
                        text: ""
                        color: 20/255, 26/255, 28/255, 0.7
                        font_size: sp(14)
                        italic: True
                        size_hint_y: None
                        height: dp(25)
                        text_size: self.size
                        halign: "center"
                        valign: "middle"
                    
                    # Espacio separador
                    Widget:
                        size_hint_y: None
                        height: dp(20)
        
        # Footer
        BoxLayout:
            size_hint_y: None
            height: dp(80)
            padding: [dp(20), dp(15)]
            spacing: dp(10)
            
            canvas.before:
                Color:
                    rgba: 204/255, 197/255, 185/255, 1  # #CCC5B9
                Rectangle:
                    pos: self.pos
                    size: self.size
                Color:
                    rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                Line:
                    width: dp(1)
                    points: [self.x, self.y + self.height, self.x + self.width, self.y + self.height]
            
            Button:
                text: "Registrar Cuenta"
                background_color: 0, 0, 0, 0
                color: 20/255, 26/255, 28/255, 1
                font_size: sp(14)
                bold: True
                on_press: root.register_action()
                canvas.before:
                    Color:
                        rgba: 168/255, 159/255, 145/255, 1  # #A89F91
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8)]
                    Color:
                        rgba: 20/255, 26/255, 28/255, 1  # #141A1C
                    Line:
                        width: dp(1)
                        rounded_rectangle: (self.x, self.y, self.width, self.height, dp(8))